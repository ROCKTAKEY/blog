+++
title = "GNU Guix Systemをインストールする"
author = ["ROCKTAKEY"]
date = 2020-08-04T00:00:00+09:00
lastmod = 2022-05-05T01:25:33+09:00
draft = true
+++

## はじめに {#はじめに}

GNU Guix System(以下Guix System)とは、GNUの開発するLinuxディストロのひとつで、GNU Guix(以下Guix)というパッケージマネージャと密結合している。GuixはSchemeで管理できるパッケージマネージャで、隔離された環境によるビルドやロールバック可能な操作が特徴で、再現性と環境の隔離に重点を置いている。これをWindowsの入ったx64のPCにインストールする。面倒なので新しいディスクを用意してそちらにインストールした。
Windowsのディスクはそのまま残したので、起動時にF12を連打してブートディスクを選択すればWindowsも起動できる。


## 必要なもの {#必要なもの}

インストール先のPC
: 私はWindows 10、Bitlockerで暗号化されたディスクの組み合わせのPCにインストールした。

USBメモリかDVDドライブ
: インストールディスクを一時的に作る必要がある。容量は8GBあれば余裕だと思う(たぶん2GBもない)。

内蔵SSDかHDD
: 必須ではないが、Windowsと共存させたい場合、ディスクを分けるのが最も楽。元のWindowsを潰してよいならそこに上書きすればよいと思うが、保証はできない。あんまりやらないけど、外付けでも同様にできるとは思う。


## ディスクの準備 {#ディスクの準備}

私はWindowsユーザーなので、Rufusを使ってUSBにインストールディスクを作成した。LinuxのPCがある場合は
[公式のドキュメント](https://guix.gnu.org/manual/en/html_node/USB-Stick-and-DVD-Installation.html)のとおりにやるとよいと思います。

まず、[公式サイト](https://guix.gnu.org/ja/download/)からGNU Guix SystemのISOファイルをダウンロードして、適当なUSBメモリやDVDに焼く。

Rufusでディスクイメージを作る際に注意点がある。
ISOモードではなくDDモードで焼いてほしい。そうしないとちゃんとbootできない。これはRufusのはじめの画面では選択できず、「スタート」を押した後に聞いてくるので、そのときに「ISOモード(推奨)」ではなく「DDモード」を選択して欲しい。


## ブートディスクの変更 {#ブートディスクの変更}

PCのメーカーや購入時期によって違うと思うので詳しい説明は省く。先程作ったインストールディスクからブートされるよう、BIOSやUEFIの設定を変えておけばよい。


## GUI(風)インストーラでインストール {#gui--風--インストーラでインストール}

あんまり需要はないかもしれないが、言葉だけだとわかりにくいかもしれないので、画像を付けておく。

さて、インストールディスクからのブートが成功すると、以下のような画面が得られる。
Locale languageなので「日本語」を選択。ちなみに日本語を選んでもインストーラは英語のまま。

<a id="figure--fig:locale-language"></a>

{{< figure src="https://raw.githubusercontent.com/ROCKTAKEY/images/blog/2022-ea617625-23b7-03b4-5273-69d79d393b85/locale-language.png" caption="<span class=\"figure-number\">Figure 1: </span>Locale language" >}}

次に、Locale locationで「日本」を選択。

<a id="figure--fig:label"></a>

{{< figure src="https://raw.githubusercontent.com/ROCKTAKEY/images/blog/2022-ea617625-23b7-03b4-5273-69d79d393b85/locale-location.png" caption="<span class=\"figure-number\">Figure 2: </span>Locale location" >}}

ここでインストーラの選択画面が表れる。GUI風のインストーラを使いたいので「Graphical install using a terminal based interface」を選択。

<a id="figure--fig:label"></a>

{{< figure src="https://raw.githubusercontent.com/ROCKTAKEY/images/blog/2022-ea617625-23b7-03b4-5273-69d79d393b85/gnu-guix-install.png" caption="<span class=\"figure-number\">Figure 3: </span>GNU Guix install" >}}

タイムゾーンを「Asia」「Tokyo」と選択。

<a id="figure--fig:label"></a>

{{< figure src="https://raw.githubusercontent.com/ROCKTAKEY/images/blog/2022-ea617625-23b7-03b4-5273-69d79d393b85/timezone-1.png" caption="<span class=\"figure-number\">Figure 4: </span>Timezoneの大まかな地域選択" >}}

<a id="figure--fig:label"></a>

{{< figure src="https://raw.githubusercontent.com/ROCKTAKEY/images/blog/2022-ea617625-23b7-03b4-5273-69d79d393b85/timezone-2.png" caption="<span class=\"figure-number\">Figure 5: </span>Timezoneの選択" >}}

次にキーボードレイアウトを選択。日本語配列なら「日本語」を選択。

<a id="figure--fig:label"></a>

{{< figure src="https://raw.githubusercontent.com/ROCKTAKEY/images/blog/2022-ea617625-23b7-03b4-5273-69d79d393b85/layout.png" caption="<span class=\"figure-number\">Figure 6: </span>(キーボードの)Layout" >}}

キーボードレイアウトにもバリエーションがあるので、それを選択。こだわりがなければ「日本語」にしておけばよい。

<a id="figure--fig:label"></a>

{{< figure src="https://raw.githubusercontent.com/ROCKTAKEY/images/blog/2022-ea617625-23b7-03b4-5273-69d79d393b85/variant.png" caption="<span class=\"figure-number\">Figure 7: </span>(キーボードレイアウトの)Variant" >}}

PCの名前を入力する。

<a id="figure--fig:label"></a>

{{< figure src="https://raw.githubusercontent.com/ROCKTAKEY/images/blog/2022-ea617625-23b7-03b4-5273-69d79d393b85/hostname.png" caption="<span class=\"figure-number\">Figure 8: </span>Hostname" >}}

代替サーバの検索を有効にするか選択。このオプションをオンにすると、LAN内のサーバからビルド済みバイナリを探して、インストールでそれも利用するようにする。これをオンにすればダウンロードの速度の向上が期待される。(おそらくハッシュ値を利用して)純正であると確認されたものだけを使うので、セキュリティリスクはないが、盗聴している人がいる場合はなにをインストールしているか見ることができる。

<a id="figure--fig:label"></a>

{{< figure src="https://raw.githubusercontent.com/ROCKTAKEY/images/blog/2022-ea617625-23b7-03b4-5273-69d79d393b85/substitute-server-discovory.png" caption="<span class=\"figure-number\">Figure 9: </span>Substitute server discovory." >}}

rootのパスワードを入力。ある程度強いものにしておきましょう。

<a id="figure--fig:label"></a>

{{< figure src="https://raw.githubusercontent.com/ROCKTAKEY/images/blog/2022-ea617625-23b7-03b4-5273-69d79d393b85/system-administrator-password.png" caption="<span class=\"figure-number\">Figure 10: </span>System administrator password" >}}

<a id="figure--fig:label"></a>

{{< figure src="https://raw.githubusercontent.com/ROCKTAKEY/images/blog/2022-ea617625-23b7-03b4-5273-69d79d393b85/password-confirmation-required.png" caption="<span class=\"figure-number\">Figure 11: </span>(System administrator passwordの) Password confirmation required" >}}

ユーザの作成。 `TAB` キーで「Add」を選択し、 `Enter` してユーザ情報を入力。「Name」がユーザ名になる。

<a id="figure--fig:label"></a>

{{< figure src="https://raw.githubusercontent.com/ROCKTAKEY/images/blog/2022-ea617625-23b7-03b4-5273-69d79d393b85/user-creation-1.png" caption="<span class=\"figure-number\">Figure 12: </span>User creation" >}}

<a id="figure--fig:label"></a>

{{< figure src="https://raw.githubusercontent.com/ROCKTAKEY/images/blog/2022-ea617625-23b7-03b4-5273-69d79d393b85/user-creation-2.png" caption="<span class=\"figure-number\">Figure 13: </span>User creation(新規追加画面)" >}}

<a id="figure--fig:label"></a>

{{< figure src="https://raw.githubusercontent.com/ROCKTAKEY/images/blog/2022-ea617625-23b7-03b4-5273-69d79d393b85/user-creation-password-confirm-required.png" caption="<span class=\"figure-number\">Figure 14: </span>User creation(パスワードの確認)" >}}

<a id="figure--fig:label"></a>

{{< figure src="https://raw.githubusercontent.com/ROCKTAKEY/images/blog/2022-ea617625-23b7-03b4-5273-69d79d393b85/user-creation-3.png" caption="<span class=\"figure-number\">Figure 15: </span>User creation(ユーザ追加後)" >}}

デスクトップ環境を選択。=SPC= でチェックをつけられる。複数選択可なので、今後使ってみたいものは気軽に入れてしまってもいいかも。複数選んでもデフォルトは勝手にGNOMEになったので、違うものを入れてしまって戸惑うみたいなことにはならなそう。私はとりあえずデフォルトの「GNOME」と今後使ってみたい「Emacs EXWM」を追加した。

<a id="figure--fig:label"></a>

{{< figure src="https://raw.githubusercontent.com/ROCKTAKEY/images/blog/2022-ea617625-23b7-03b4-5273-69d79d393b85/desktop-environment.png" caption="<span class=\"figure-number\">Figure 16: </span>Desktop environment" >}}

ネットワークサービスを選択。基本はデフォルトのままでよさそう。
SSHで外から入りたい場合はOpenSSHのデーモンを有効にしないといけないかもしれない(よくしらない)。

<a id="figure--fig:label"></a>

{{< figure src="https://raw.githubusercontent.com/ROCKTAKEY/images/blog/2022-ea617625-23b7-03b4-5273-69d79d393b85/network-service.png" caption="<span class=\"figure-number\">Figure 17: </span>Network service" >}}

パーティションをどのように切るかの流れを選択。パーティションとは、ざっくり言えばディスクの切り分けのこと(なはず)。よく知らない場合は、「Guided - using the entire disk」か「Guided using the entire disk with encryption」を選んでおくとよい。後者を選ぶとディスクが暗号化される。立ち上げる前にパスワードを要求されるようになるが、ディスクを盗まれたり廃棄したり警察に押収されたりしたときに中身を勝手に見られることを防ぐことができるので、なるべくこちらを選ぶことをおすすめする。ここでも後者を選択する。「Manual」にすれば、一つのディスクで複数のOSを取り回せると思うが、試していない。上級者向け。

<a id="figure--fig:label"></a>

{{< figure src="https://raw.githubusercontent.com/ROCKTAKEY/images/blog/2022-ea617625-23b7-03b4-5273-69d79d393b85/partitioning-method.png" caption="<span class=\"figure-number\">Figure 18: </span>Partitioning method" >}}

使うディスクを選択。ここで間違ったディスクを選択するとそのディスクの中身は二度と戻りません。慎重に選びましょう。

<a id="figure--fig:label"></a>

{{< figure src="https://raw.githubusercontent.com/ROCKTAKEY/images/blog/2022-ea617625-23b7-03b4-5273-69d79d393b85/disk-2.png" caption="<span class=\"figure-number\">Figure 19: </span>Disk" >}}

パーティションの切り方を選択。といってもhomeディレクトリを別のパーティションとして切るか否かを聞いている。
homeディレクトリを分けることによって、今回のようにOSをインストールする際にhome以下のデータをそのままとっておける。私はそこまで魅力を感じなかった(それよりもパーティションが分かれることによる管理コストのほうが面倒そう)ので、「Everything is one partition」を選択。

<a id="figure--fig:label"></a>

{{< figure src="https://raw.githubusercontent.com/ROCKTAKEY/images/blog/2022-ea617625-23b7-03b4-5273-69d79d393b85/partition-scheme.png" caption="<span class=\"figure-number\">Figure 20: </span>Partition scheme" >}}

最後の確認。選択したディスクが消えてもよいディスクかしっかり確認して、「OK」を選択。

<a id="figure--fig:label"></a>

{{< figure src="https://raw.githubusercontent.com/ROCKTAKEY/images/blog/2022-ea617625-23b7-03b4-5273-69d79d393b85/guided-partitioning.png" caption="<span class=\"figure-number\">Figure 21: </span>Guided partitioning" >}}

ディスクの暗号化に使うパスワードを入力。これもそこそこの長さにしておこう。ディスクに対するパスワードなので、ネットワーク経由の攻撃とは違い、総当たりに対してソフトウェア的なブロックは見込めない。総当たりされても一生解読されないくらいの長さにしましょう。

<a id="figure--fig:label"></a>

{{< figure src="https://raw.githubusercontent.com/ROCKTAKEY/images/blog/2022-ea617625-23b7-03b4-5273-69d79d393b85/encrypt-password-required.png" caption="<span class=\"figure-number\">Figure 22: </span>(ディスク暗号化の)Password required" >}}

<a id="figure--fig:label"></a>

{{< figure src="https://raw.githubusercontent.com/ROCKTAKEY/images/blog/2022-ea617625-23b7-03b4-5273-69d79d393b85/encrypt-password-confirmation-required.png" caption="<span class=\"figure-number\">Figure 23: </span>(ディスク暗号化の)Password confirmation required" >}}

本当にフォーマットして(パーティション切って)よいか最後の確認。「Continue」を押すと二度と戻れません。ここで確認できることは多くないですが、よいと思ったら「Continue」を選択。

<a id="figure--fig:label"></a>

{{< figure src="https://raw.githubusercontent.com/ROCKTAKEY/images/blog/2022-ea617625-23b7-03b4-5273-69d79d393b85/format-disk.png" caption="<span class=\"figure-number\">Figure 24: </span>Format disk?" >}}

すると以下の画面になるので、少し待つ。

<a id="figure--fig:label"></a>

{{< figure src="https://raw.githubusercontent.com/ROCKTAKEY/images/blog/2022-ea617625-23b7-03b4-5273-69d79d393b85/preparing-partitions.png" caption="<span class=\"figure-number\">Figure 25: </span>Preparing partitions" >}}
